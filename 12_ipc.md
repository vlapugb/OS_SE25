# IPC (Inter-Process Communication): подробное описание механизмов

## 1. Общая идея IPC

IPC — это механизмы, предоставляемые операционной системой для взаимодействия изолированных процессов.
Так как каждый процесс имеет собственное виртуальное адресное пространство, прямой доступ к памяти других процессов запрещён.  
IPC решает эту проблему контролируемым и безопасным образом.

Основные задачи IPC:
- передача данных;
- синхронизация;
- уведомление о событиях;
- организация архитектур «клиент–сервер».

---

## 2. Pipes (каналы)

### 2.1 Anonymous pipes

**Неименованные каналы** — самый простой IPC-механизм.

Характеристики:
- однонаправленный поток байтов;
- работают только между родственными процессами (parent–child);
- не имеют имени в файловой системе;
- создаются системным вызовом `pipe()`.

Применение:
- передача данных между процессами в shell (`cmd1 | cmd2`);
- простые цепочки обработки данных.

Ограничения:
- нет структуры сообщений;
- нельзя использовать для произвольных процессов.

---

### 2.2 Named pipes (FIFO)

**Именованные каналы (FIFO)** расширяют возможности pipes.

Особенности:
- имеют имя в файловой системе;
- могут использоваться неродственными процессами;
- поддерживают однонаправленный поток данных.

Создание:
- `mkfifo` или системный вызов `mkfifo()`.

Использование:
- простые IPC-сценарии между сервисами;
- обмен потоковыми данными.

---

## 3. Очереди сообщений (Message Queues)

### 3.1 Общая идея

Очереди сообщений позволяют передавать **дискретные сообщения**, а не поток байтов.

Сообщение включает:
- тип (или приоритет);
- полезную нагрузку;
- размер.

---

### 3.2 System V Message Queues

Особенности:
- идентифицируются ключом;
- сообщения выбираются по типу;
- ядро управляет очередью.

Плюсы:
- асинхронный обмен;
- адресация сообщений.

Минусы:
- устаревший API;
- сложность очистки ресурсов.

---

### 3.3 POSIX Message Queues

Улучшения:
- именованные очереди;
- файловая семантика;
- лучшая переносимость.

Использование:
- серверные приложения;
- системы управления задачами.

---

## 4. Shared Memory (разделяемая память)

### 4.1 Принцип работы

Разделяемая память позволяет нескольким процессам:
- отобразить один и тот же участок физической памяти;
- работать с данными напрямую, без копирования.

Создаётся через:
- System V (`shmget`);
- POSIX (`shm_open`).

---

### 4.2 Производительность

Преимущества:
- максимальная скорость IPC;
- отсутствие копирования данных.

Недостатки:
- сложность синхронизации;
- риск гонок данных.

---

### 4.3 Синхронизация

Для корректной работы используются:
- семафоры;
- мьютексы;
- атомарные операции.

---

## 5. Семафоры

### 5.1 Назначение

Семафоры предназначены для **синхронизации**, а не передачи данных.

Работают как счётчик:
- `P()` — уменьшение (ожидание);
- `V()` — увеличение (сигнал).

---

### 5.2 Виды семафоров

- бинарные (0 или 1);
- счётные (N ресурсов).

Используются для:
- ограничения доступа;
- упорядочивания выполнения процессов.

---

## 6. Мьютексы

**Мьютекс** — механизм взаимного исключения.

Особенности:
- только один владелец;
- блокирует остальных.

Используется:
- чаще между потоками;
- возможен межпроцессный вариант (POSIX mutex + shared memory).

---

## 7. Сигналы

### 7.1 Суть сигналов

**Сигналы** — асинхронные уведомления процессу.

Примеры:
- `SIGTERM`, `SIGKILL`;
- `SIGINT`;
- `SIGSEGV`.

---

### 7.2 Особенности

- не предназначены для передачи данных;
- используются для управления и уведомлений;
- могут прерывать выполнение процесса.

---

## 8. Сокеты

### 8.1 Общая концепция

**Сокеты** — самый универсальный IPC-механизм.

Позволяют:
- локальное взаимодействие;
- сетевое взаимодействие.

---

### 8.2 UNIX Domain Sockets

Особенности:
- работают только внутри одной ОС;
- высокая производительность;
- файловая адресация.

Используются:
- systemd;
- X11;
- DBus.

---

### 8.3 Internet Sockets (TCP/UDP)

Используются для:
- сетевых сервисов;
- распределённых систем.

Поддерживают:
- надёжную (TCP);
- ненадёжную (UDP) передачу данных.

---

## 9. System V IPC vs POSIX IPC

| Критерий | System V | POSIX |
|--------|---------|-------|
| Современность | Устаревший | Современный |
| Именование | Ключи | Имена |
| Очистка | Сложная | Простая |
| Переносимость | Ограниченная | Высокая |

---

## 10. Выбор IPC-механизма

Выбор зависит от:
- скорости;
- объёма данных;
- сложности реализации;
- локального или сетевого характера взаимодействия;
- требований к синхронизации.

---

## 11. Итог

IPC предоставляет:
- разные уровни абстракции;
- баланс между скоростью и удобством;
- фундамент для построения многопроцессных систем.

Грамотный выбор IPC — ключ к корректной и производительной архитектуре ОС и приложений.

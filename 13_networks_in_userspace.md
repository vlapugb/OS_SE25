# Сети в пространстве пользователя: инструменты командной строки

## 1. Сети в пространстве пользователя: общий смысл

Сетевое взаимодействие в ОС можно условно разделить на два уровня:

1. **Уровень ядра (kernel space)**  
   - Реализация сетевого стека (TCP/IP, UDP и др.).
   - Обработка пакетов, маршрутизация, фильтрация (iptables/nftables, firewall).
   - Драйверы сетевых карт, обработка прерываний.

2. **Уровень пользовательского пространства (user space)**  
   - Обычные программы, которые:
     - используют системные вызовы (socket, connect, send, recv и т.п.);
     - строят поверх этого удобные интерфейсы и утилиты;
   - сюда относятся **сетевые инструменты командной строки**, которыми администратор и пользователь управляет сетью и диагностирует её.

В этом билете под «сети в пространстве пользователя» в первую очередь понимается **набор утилит командной строки**, позволяющих:
- настраивать сетевые параметры;
- проверять доступность хостов;
- диагностировать маршруты и проблемы;
- работать с DNS;
- устанавливать соединения и передавать данные.

---

## 2. Настройка и просмотр сетевых интерфейсов

### 2.1. Исторический инструмент: `ifconfig`

`ifconfig` (interface config) — классическая утилита для:
- просмотра и настройки сетевых интерфейсов.

Основные возможности:
- отобразить список интерфейсов и их параметры:
  ```bash
  ifconfig           # показать все активные интерфейсы
  ifconfig eth0      # информация только об eth0
  ```
- назначить IP-адрес:
  ```bash
  ifconfig eth0 192.168.1.10 netmask 255.255.255.0 up
  ```
- включить/выключить интерфейс:
  ```bash
  ifconfig eth0 up
  ifconfig eth0 down
  ```

Замечание:
- во многих современных системах `ifconfig` считается устаревшим;
- его функциональность заменена утилитой `ip`.

### 2.2. Современный инструмент: `ip` (из набора iproute2)

`ip` — универсальная утилита для управления сетью:
- интерфейсы;
- адреса;
- маршруты;
- туннели;
- правила маршрутизации.

Примеры:

1. **Просмотр интерфейсов:**
   ```bash
   ip link show
   ip link show dev eth0
   ```
2. **Назначение IP-адреса:**
   ```bash
   ip addr add 192.168.1.10/24 dev eth0
   ip addr show dev eth0
   ```
3. **Включение/выключение интерфейса:**
   ```bash
   ip link set eth0 up
   ip link set eth0 down
   ```
4. **Просмотр и настройка маршрутов:**
   ```bash
   ip route show
   ip route add default via 192.168.1.1
   ```

Преимущество `ip`:
- единый синтаксис;
- поддержка современных возможностей Linux-сетей (VLAN, мосты, namespaces и т.п.).

---

## 3. Диагностика доступности: `ping`

### 3.1. Назначение `ping`

`ping` — базовая утилита для проверки:
- **доступности удалённого хоста** по сети;
- времени отклика.

Работает на основе:
- отправки ICMP Echo Request;
- ожидания ICMP Echo Reply.

Пример:
```bash
ping 8.8.8.8
ping ya.ru
```

### 3.2. Интерпретация результата

Типичные поля:
- `time=... ms` — время «туда-обратно»;
- `ttl` — шаг до цели (time to live, сколько маршрутизаторов прошло);
- статистика в конце:
  - количество отправленных/полученных пакетов;
  - процент потерь;
  - минимальное/среднее/максимальное время.

Используется для:
- проверки наличия сетевого пути;
- грубой оценки качества канала.

---

## 4. Диагностика маршрутов: `traceroute` / `tracepath`

### 4.1. `traceroute`

`traceroute` показывает **последовательность маршрутизаторов** (хопов), через которые проходят пакеты до назначения.

Принцип работы:
- отправляет пакеты с постепенно увеличивающимся TTL (1, 2, 3, …);
- каждый маршрутизатор, уменьшив TTL до 0, отправляет ICMP Time Exceeded;
- по этим ответам определяется цепочка хопов.

Пример:
```bash
traceroute ya.ru
```

Вывод:
- список промежуточных адресов/имен узлов;
- время ответа от каждого хопа.

### 4.2. `tracepath`

Аналогичная по назначению утилита:
- часто не требует прав суперпользователя;
- даёт упрощённый вывод маршрута.

Пример:
```bash
tracepath ya.ru
```

---

## 5. Просмотр соединений и портов: `netstat` и `ss`

### 5.1. `netstat` (устаревающий, но встречается)

Назначение:
- показать:
  - активные сетевые соединения;
  - прослушиваемые порты;
  - статистику по протоколам.

Примеры:
```bash
netstat -tulpn   # TCP/UDP, listening, с PID/именем процесса
netstat -an      # все соединения в числовом виде
```

Флаги:
- `-t` — TCP;
- `-u` — UDP;
- `-l` — listening (прослушиваемые);
- `-p` — показать PID/программу;
- `-n` — показывать IP и порты числами.

### 5.2. `ss` (socket statistics) — современная альтернатива `netstat`

`ss` считается более быстрым и современным инструментом.

Примеры:
```bash
ss -tulpn       # аналог netstat -tulpn
ss -s           # краткая статистика по сокетам
ss -tan state ESTAB  # только установленные TCP-соединения
```

Используется для:
- анализа использования портов;
- поиска «подвисших» соединений;
- диагностики сетевой активности процессов.

---

## 6. DNS-диагностика: `nslookup`, `dig`, `host`

### 6.1. Задача DNS-инструментов

DNS (Domain Name System) — система, переводящая:
- доменные имена → IP-адреса;
- и наоборот (обратный DNS).

Инструменты:
- помогают понять:
  - какой IP соответствует домену;
  - какие записи (A, AAAA, MX, TXT и т.д.) существуют;
  - какой DNS-сервер что отвечает.

### 6.2. `nslookup`

Классический инструмент:
```bash
nslookup ya.ru
nslookup 8.8.8.8
```

Может:
- работать в интерактивном и неинтерактивном режиме;
- указывать конкретный DNS-сервер:
  ```bash
  nslookup ya.ru 8.8.8.8
  ```

### 6.3. `dig` (Domain Information Groper)

Более продвинутый инструмент, часто предпочтительный для администраторов.

Примеры:
```bash
dig ya.ru
dig ya.ru A
dig ya.ru MX
dig +short ya.ru
dig @8.8.8.8 ya.ru
```

Преимущества:
- гибкий формат вывода;
- подробная информация (время, сервер, секции ответа).

### 6.4. `host`

Простая утилита:
```bash
host ya.ru
host 8.8.8.8
```

Даёт компактную информацию:
- IP-адрес для имени;
- имя для IP (обратная зона).

---

## 7. Утилиты для проверки портов и простых соединений: `telnet`, `nc` (netcat)

### 7.1. `telnet` (для проверки TCP-портов)

Исторически:
- использовался для интерактивного текстового доступа к удалённым системам (протокол Telnet, небезопасен, передаёт пароли в открытом виде).

Сегодня:
- часто применяется только как простой способ:
  - проверить «открыт ли порт»;
  - вручную «поговорить» с сервисом по TCP (HTTP, SMTP и др.).

Пример:
```bash
telnet example.com 80
```

Можно вручную послать HTTP-запрос и посмотреть ответ.

### 7.2. `nc` (netcat) — «швейцарский нож» сетей

Возможности `nc`:
- проверить соединяемость к порту:
  ```bash
  nc -vz example.com 80
  ```
- открыть простой сервер:
  ```bash
  nc -l 1234
  ```
- перенаправлять данные между потоками:
  - удобно для отладки и простых сетевых обменов.

netcat умеет:
- работать с TCP/UDP;
- использоваться как примитивный чат, файловый передатчик и т.п.

---

## 8. Утилиты для HTTP и других протоколов: `curl`, `wget`

### 8.1. `curl`

`curl` — мощная утилита для:
- отправки запросов по различным протоколам (в основном HTTP/HTTPS);
- отладки веб-сервисов и API.

Примеры:
```bash
curl https://example.com
curl -I https://example.com      # только заголовки
curl -X POST -d 'a=1&b=2' https://example.com/form
curl -H 'User-Agent: Test' https://example.com
```

Применение:
- проверка доступности веб-сайтов;
- отладка HTTP-заголовков и ответов;
- работа с REST API.

### 8.2. `wget`

Специализируется на:
- **загрузке файлов** по HTTP/HTTPS/FTP.

Примеры:
```bash
wget https://example.com/file.iso
wget -r https://example.com/   # рекурсивная загрузка сайта (осторожно!)
```

---

## 9. SSH и удалённое управление: `ssh`, `scp`, `sftp`

### 9.1. `ssh` (Secure Shell)

`ssh` — стандартный инструмент:
- для защищённого удалённого доступа к командной строке;
- для туннелирования и перенаправления портов.

Примеры:
```bash
ssh user@server
ssh -p 2222 user@server        # нестандартный порт
ssh -L 8080:localhost:80 user@server   # локальный портфорвардинг
```

### 9.2. `scp` и `sftp`

- `scp` — копирование файлов по SSH:
  ```bash
  scp file.txt user@server:/home/user/
  ```
- `sftp` — интерактивный файловый клиент поверх SSH:
  ```bash
  sftp user@server
  ```

Эти утилиты работают полностью в пользовательском пространстве, используя протокол SSH поверх TCP.

---

## 10. Дополнительные полезные сетевые инструменты

### 10.1. `arp` / `ip neigh`

Для просмотра таблицы ARP (сопоставление IP→MAC):

```bash
arp -n
ip neigh
```

Позволяют:
- понять, какие MAC-адреса известных соседей в локальной сети.

### 10.2. `route` / `ip route`

Просмотр и настройка маршрутов (вместе с `ip`):

```bash
route -n
ip route show
```

Позволяют:
- увидеть, через какой шлюз идут пакеты в разные сети;
- настраивать маршрутизацию.

### 10.3. `tcpdump` (кратко)

Хотя это уже более «низкоуровневый» инструмент:
- `tcpdump` позволяет **перехватывать и анализировать пакеты** непосредственно в пользовательском пространстве;
- используется для глубокой диагностики сетевых проблем.

Пример:
```bash
tcpdump -i eth0
tcpdump -i eth0 port 80
```

---

## 11. Общая роль сетевых CLI-инструментов в пользовательском пространстве

1. **Диагностика проблем**:
   - недоступен ли хост (`ping`);
   - где обрывается маршрут (`traceroute`);
   - открыт ли порт (`nc`, `telnet`);
   - что отвечает DNS (`dig`, `nslookup`, `host`).

2. **Мониторинг и анализ**:
   - какие порты слушаются и кем (`ss`, `netstat`);
   - какие интерфейсы активны (`ip`, `ifconfig`);
   - состояние ARP, маршруты (`ip neigh`, `ip route`).

3. **Настройка и управление**:
   - конфигурация IP-адресов и интерфейсов (`ip addr`, `ip link`);
   - настройка маршрутов (`ip route`).

4. **Работа с прикладными протоколами**:
   - HTTP-запросы (`curl`, `wget`);
   - удалённый доступ (`ssh`, `scp`, `sftp`).

Все эти утилиты:
- работают в **пространстве пользователя**;
- используют системные вызовы и интерфейсы, предоставленные ядром;
- позволяют администратору управлять сетью и решать проблемы **без прямого вмешательства в ядро**.

---

## 12. Краткий конспект (для запоминания)

1. **Сети в пространстве пользователя** — это, прежде всего, набор утилит командной строки, которые:
   - используют сетевой стек ядра через системные вызовы;
   - позволяют настраивать сеть, диагностировать проблемы и работать с протоколами.

2. **Интерфейсы и адреса:**
   - `ifconfig` — старый инструмент;
   - `ip` — современный универсальный инструмент (`ip link`, `ip addr`, `ip route`).

3. **Проверка доступности:**
   - `ping` — ICMP Echo, проверка «жива ли цель» и задержки.

4. **Маршрутизация и путь:**
   - `traceroute`, `tracepath` — показывают цепочку маршрутизаторов.

5. **Порты и соединения:**
   - `netstat` (устаревший) и `ss` — активные соединения, прослушиваемые порты.

6. **DNS:**
   - `nslookup`, `dig`, `host` — проверка записей DNS, резолв доменных имён.

7. **Проверка портов и обмен данными:**
   - `telnet` — тестирование TCP-портов;
   - `nc` (netcat) — универсальный инструмент для TCP/UDP-соединений.

8. **HTTP и веб:**
   - `curl` — гибкие запросы к веб-серверам и API;
   - `wget` — загрузка файлов.

9. **Удалённый доступ:**
   - `ssh` — безопасный удалённый вход;
   - `scp`, `sftp` — копирование файлов по SSH.

10. **Прочие:**
    - `ip neigh`, `arp` — таблица ARP;
    - `ip route`, `route` — маршруты;
    - `tcpdump` — анализ пакетов.

Этот конспект можно использовать как развернутый ответ на экзаменационный билет  
**«Сети в пространстве пользователя: инструменты командной строки»**.
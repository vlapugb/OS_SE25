# POSIX — понятия на примере текстового файла

## 1. Что такое POSIX

POSIX (Portable Operating System Interface) — семейство стандартов, задающих единый интерфейс между приложением и ОС. Цели:
- переносимость программ между Unix‑подобными системами;
- предсказуемое поведение системных вызовов, оболочки и базовых утилит;
- единые типы данных и соглашения об ошибках.

## 2. Структура стандарта (коротко)
- **XBD (Base Definitions)** — терминология, типы данных, константы, правила синтаксиса и поведения путей, локалей, переменных окружения.
- **XSH (System Interfaces)** — системные вызовы и функции libc (open, read, fork, execve и т.д.).
- **XCU (Shell and Utilities)** — поведение POSIX‑совместимой оболочки `/bin/sh` и стандартных утилит.
- **XRAT (Rationale)** — комментарии и обоснования решений (необязательная часть).

## 3. Текстовый файл в модели POSIX
- В POSIX почти всё представлено как файл: обычные файлы, каталоги, устройства, сокеты, каналы.
- **Текстовый файл** — последовательность строк без байтов `NUL`, каждая строка не длиннее `LINE_MAX` и оканчивается переводом строки. Многие утилиты корректно работают только с такими файлами.
- Важно различать **имя файла (путь)** и **сам объект** в файловой системе. Имя — это запись в каталоге, объект — inode с данными и метаданными.

## 4. Пути и каталоги
- Абсолютный путь начинается с `/`; относительный задаётся от текущего каталога процесса. Спецкаталоги: `.` (текущий), `..` (родитель).
- Каталог — особый файл, содержащий пары «имя → inode». Несколько записей каталога могут ссылаться на один inode (жёсткие ссылки).

## 5. Inode и ссылки
- Inode хранит тип объекта, права, владельца, размеры, временные метки и указатели на блоки данных.
- `link()` создаёт дополнительную жёсткую ссылку на inode; `unlink()` удаляет имя из каталога и освобождает объект, когда счётчик ссылок и число открытых дескрипторов становятся нулём.

## 6. Файловые дескрипторы
- Файловый дескриптор — целое число, индекс в таблице открытых файлов процесса. Оно указывает на «открытое описание файла» с текущим смещением и флагами.
- Стандартные дескрипторы: `0` — stdin, `1` — stdout, `2` — stderr. После `fork()` дескрипторы копируются и указывают на те же открытые файлы.

## 7. Базовые системные вызовы (кратко)
- `open(path, flags, mode)` — открыть/создать файл, вернуть дескриптор; проверяет права доступа.
- `read(fd, buf, count)` / `write(fd, buf, count)` — чтение/запись данных с продвижением смещения.
- `lseek(fd, off, whence)` — изменить смещение (не работает для pipe/tty).
- `close(fd)` — закрыть дескриптор.
- `stat(path, *st)` — метаданные (тип, размер, права, время, число ссылок).
- `unlink(path)` — удалить запись каталога.
Подробное API разобрано в билете `10_posix_file_api.md`.

## 8. Итог
- POSIX фиксирует единое поведение системных вызовов, оболочки и утилит.
- Текстовый файл — упорядоченные строки без `NUL`; имя и файл — разные сущности.
- Доступ к файлам идёт через inode и дескрипторы; имена живут в каталогах, ссылки могут быть множественными.
- Базовые вызовы работы с файлом: open/read/write/lseek/close/stat/unlink; права и ссылки контролируют доступ и время жизни объекта.
